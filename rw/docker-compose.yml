version: '3.8'
services:
  venv-setup:
    image: python:3.11-slim
    env_file: .env
    volumes:
      - ./:/workspace
    working_dir: /workspace
    entrypoint:
      - "/bin/sh"
      - "-c"
      - "python -m venv .venv && . .venv/bin/activate && pip install --no-cache-dir -r requirements.txt"
    tty: true
  python:
    image: python:3.11-slim
    env_file: .env
    volumes:
      - ./:/workspace
    entrypoint:
      - "/bin/bash"
      - "-c"
      - ". .venv/bin/activate; /bin/bash" 
    working_dir: /workspace
    tty: true
  agent:
    image: python:3.11-slim
    env_file: .env
    volumes:
      - ./:/workspace
    working_dir: /workspace
    entrypoint:
      - "/bin/sh"
      - "-c"
      - ". .venv/bin/activate || true; exec python agent.py \"$@\""
    tty: true

